<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>12 Trillion Grand — Hyper-Real Extended</title>
  <!-- model-viewer for 3D statues -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    :root{--bg:#071018;--muted:#9aa6b2;--accent:#ff6b6b;--accent2:#7b61ff}
    html,body{height:100%;margin:0;font-family:Inter,system-ui;background:linear-gradient(180deg,#05070a,var(--bg));color:#e6eef6}
    .app{padding:14px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .card{background:rgba(255,255,255,0.02);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04)}
    .big{width:100%;min-height:300px}
    .controls{display:flex;gap:8px}
    button{cursor:pointer;padding:8px 12px;border-radius:8px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent2));color:white}
    .glass{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted)}
    .right{float:right}
    pre{background:#051018;padding:12px;border-radius:8px;overflow:auto}
    .footer{font-size:12px;color:var(--muted);margin-top:12px}
  </style>
</head>
<body>
  <div class="app">
    <h1>12 Trillion Grand — Extended</h1>
    <p class="muted">Added: real video/audio sources, playable pinball with flippers, WebRTC signaling + server code, 3D statues via model-viewer, TikTok-style embed wiring, and new neon theme toggles.</p>

    <div class="row">
      <!-- VIDEO / AUDIO SOURCES -->
      <div class="card" style="flex:1;min-width:320px;">
        <h3>Live Media — Video & Audio</h3>
        <video id="mainVideo" class="big" controls crossorigin playsinline>
          <!-- Public sample video (Big Buck Bunny) -->
          <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
          Your browser doesn't support HTML5 video.
        </video>
        <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
          <audio id="bgAudio" controls style="flex:1">
            <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
          </audio>
          <button id="attachAudio" class="glass">Attach Audio To Video</button>
        </div>
      </div>

      <!-- PINBALL with flippers -->
      <div class="card" style="width:560px">
        <h3>Playable Pinball — Use Z (left) / M (right) or Click Flipper Buttons</h3>
        <canvas id="pinballFull" width="560" height="380" style="background:#02080a;border-radius:8px;display:block"></canvas>
        <div class="controls" style="margin-top:8px">
          <button id="startPin">Start</button>
          <button id="resetPin" class="glass">Reset</button>
          <div style="margin-left:auto" class="glass">Score: <span id="pinScore">0</span></div>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <!-- 3D Statues via model-viewer -->
      <div class="card" style="flex:1;min-width:320px">
        <h3>3D Statues — model-viewer (change models freely)</h3>
        <div style="display:flex;gap:8px">
          <model-viewer id="statueModel" src="https://modelviewer.dev/shared-assets/models/Astronaut.glb" alt="Statue" camera-controls auto-rotate style="width:320px;height:320px;border-radius:8px;background:linear-gradient(180deg,#081018,#041018)"></model-viewer>
          <div style="flex:1;display:flex;flex-direction:column;gap:8px">
            <input id="modelUrl" class="glass" placeholder="Paste a .glb or .gltf URL here" />
            <div style="display:flex;gap:8px"><button id="loadModel">Load Model</button><button id="spinModel" class="glass">Toggle Auto-Rotate</button></div>
            <p class="muted">Tip: use free GLB models hosted on CDN or your own server. model-viewer supports PBR materials, lighting, and annotations.</p>
          </div>
        </div>
      </div>

      <!-- TikTok embed wiring -->
      <div class="card" style="width:420px">
        <h3>TikTok-style Embeds</h3>
        <p class="muted">Replace <code>VIDEO_ID</code> with a TikTok video ID to embed. If running locally, TikTok embeds may block due to CSP; use published pages or a proxy.</p>
        <div style="display:flex;gap:8px;margin-bottom:8px"><input id="tiktokId" class="glass" placeholder="VIDEO_ID (e.g. 703123456789012345)" /><button id="embedTt">Embed</button></div>
        <div id="ttEmbedWrap" style="height:420px;overflow:auto;border-radius:8px;border:1px solid rgba(255,255,255,0.03)"></div>
        <p class="muted">Fallback: use an iframe pattern: <code>&lt;iframe src='https://www.tiktok.com/embed/v2/VIDEO_ID' width='325' height='575'&gt;&lt;/iframe&gt;</code></p>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <!-- Multiplayer signaling + server code (downloadable) -->
      <div class="card" style="flex:1;min-width:420px">
        <h3>Multiplayer Signaling — WebRTC (Client + Server)</h3>
        <p class="muted">Click to download a minimal Node.js signaling server (Express + ws) and a client helper. Use for small peer-connections, lobby presence, and exchanging SDP/ICE.</p>
        <div style="display:flex;gap:8px"><button id="dlServer">Download server.js</button><button id="dlPackage" class="glass">Download package.json</button><button id="showClient">Show Client Snippet</button></div>
        <div id="clientSnippet" style="margin-top:12px;display:none">
          <pre id="clientPre">// Client snippet: connect to ws signaling server, exchange offers/answers
const ws = new WebSocket('wss://YOUR_SIGNAL_SERVER');
// on open -> join room, on messages -> handle SDP/ICE
// Use RTCPeerConnection to create offers/answers and send via ws
</pre>
        </div>
      </div>

      <!-- Theme toggles -->
      <div class="card" style="width:320px">
        <h3>Theme & Extras</h3>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button id="neonTheme">Apply Neon Theme</button>
          <button id="photorealTheme" class="glass">Photoreal Theme</button>
          <button id="pastelTheme" class="glass">Pastel Theme</button>
        </div>
        <div style="margin-top:12px"><strong>Server files included:</strong>
          <ul><li>server.js (ws signaling)</li><li>package.json</li></ul>
        </div>
      </div>
    </div>

    <div class="footer">Notes: For full features, run a local static server for CORS-friendly GLB loads and host the signaling server. TikTok embeds may not render locally due to cross-origin rules.</div>
  </div>

  <script>
    // === MEDIA HOOKS ===
    document.getElementById('attachAudio').addEventListener('click', ()=>{
      const v = document.getElementById('mainVideo'); const a = document.getElementById('bgAudio');
      // detach audio element into video using MediaElementAudioSource (mixing) — simple approach: replace video audio track
      try{
        const ctx = new AudioContext(); const dest = ctx.createMediaStreamDestination();
        const srcA = ctx.createMediaElementSource(a);
        srcA.connect(dest);
        const tracks = dest.stream.getAudioTracks();
        // remove existing audio tracks from video (if any)
        const videoStream = v.captureStream ? v.captureStream() : v.mozCaptureStream ? v.mozCaptureStream() : null;
        if(videoStream){ tracks.forEach(t=> videoStream.addTrack(t)); alert('Audio attached to video capture stream (use for capture/recording).'); }
        else alert('Browser captureStream not supported — use MediaRecorder or play both together.');
      }catch(e){ alert('Could not attach audio due to browser limitations: '+e.message); }
    });

    // === PINBALL FULL ===
    (function(){
      const canvas = document.getElementById('pinballFull'); const ctx = canvas.getContext('2d'); let anim=null; let running=false; let score=0;
      const w=canvas.width, h=canvas.height;
      const ball = {x:w/2,y:80,r:9,vx:2,vy:0};
      const leftFlipper = {x:180,y:320,len:80,angle: -0.6, angMin:-1.2, angMax:0, speed:0.28, engaged:false};
      const rightFlipper = {x:380,y:320,len:80,angle:0.6, angMin:0, angMax:1.2, speed:0.28, engaged:false};
      function draw(){ ctx.clearRect(0,0,w,h); // bg
        const g=ctx.createLinearGradient(0,0,0,h); g.addColorStop(0,'#031015'); g.addColorStop(1,'#001018'); ctx.fillStyle=g; ctx.fillRect(0,0,w,h);
        // bumpers
        [[120,180,28],[280,160,36],[440,190,24]].forEach(b=>{ ctx.beginPath(); ctx.fillStyle='rgba(255,255,255,0.03)'; ctx.arc(b[0],b[1],b[2],0,Math.PI*2); ctx.fill(); });
        // ball physics
        ball.vy += 0.12; ball.x += ball.vx; ball.y += ball.vy;
        if(ball.x<ball.r||ball.x>w-ball.r) ball.vx *= -1.02;
        if(ball.y<ball.r) ball.vy *= -0.98;
        if(ball.y>h-ball.r){ ball.y=h-ball.r; ball.vy *= -0.7; ball.vx *=0.98; }
        // flippers animate
        [leftFlipper,rightFlipper].forEach(fl => { if(fl.engaged){ if(fl===leftFlipper) fl.angle = Math.min(fl.angMax, fl.angle + fl.speed); else fl.angle = Math.max(fl.angMin, fl.angle - fl.speed); } else { if(fl===leftFlipper) fl.angle = Math.max(fl.angMin, fl.angle - fl.speed); else fl.angle = Math.min(fl.angMax, fl.angle + fl.speed); } });
        // flipper collisions (simple reflect)
        function flipperHit(fl){ const fx = fl.x, fy=fl.y; const ex = fx + Math.cos(fl.angle)*fl.len, ey = fy + Math.sin(fl.angle)*fl.len; // line from (fx,fy) to (ex,ey)
          // closest point on segment to ball
          const vx = ex-fx, vy = ey-fy; const wx = ball.x - fx, wy = ball.y - fy; const c1 = (wx*vx + wy*vy); const c2 = (vx*vx + vy*vy); const t = Math.max(0, Math.min(1, c1/c2)); const px = fx + vx*t, py = fy + vy*t; const dx = ball.x-px, dy = ball.y-py; const dist = Math.hypot(dx,dy);
          if(dist < ball.r + 6){ // collision
            // reflect velocity about flipper normal
            const nx = dx/dist, ny = dy/dist; const p = ball.vx*nx + ball.vy*ny; ball.vx -= 2*p*nx; ball.vy -= 2*p*ny; // add flipper kick
            ball.vx += (fl===leftFlipper? -1:1) * 3; ball.vy -= 2; score += 10; document.getElementById('pinScore').innerText = score;
          }
        }
        flipperHit(leftFlipper); flipperHit(rightFlipper);
        // draw flippers
        function drawFl(fl, color){ ctx.save(); ctx.translate(fl.x,fl.y); ctx.rotate(fl.angle); ctx.fillStyle=color; ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(fl.len, -10); ctx.arc(fl.len-10,0,10, -0.5, 0.5); ctx.lineTo(0,10); ctx.closePath(); ctx.fill(); ctx.restore(); }
        drawFl(leftFlipper,'#ff7b7b'); drawFl(rightFlipper,'#7b61ff');
        // draw ball
        ctx.beginPath(); ctx.fillStyle='white'; ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2); ctx.fill();
      }
      function loop(){ draw(); if(running) anim = requestAnimationFrame(loop); }
      document.getElementById('startPin').addEventListener('click', ()=>{ if(!running){ running=true; anim=requestAnimationFrame(loop); }});
      document.getElementById('resetPin').addEventListener('click', ()=>{ ball.x=w/2; ball.y=80; ball.vx=2; ball.vy=0; score=0; document.getElementById('pinScore').innerText=score; });
      // controls: keyboard Z / M
      window.addEventListener('keydown',(e)=>{ if(e.key.toLowerCase()==='z') leftFlipper.engaged=true; if(e.key.toLowerCase()==='m') rightFlipper.engaged=true; });
      window.addEventListener('keyup',(e)=>{ if(e.key.toLowerCase()==='z') leftFlipper.engaged=false; if(e.key.toLowerCase()==='m') rightFlipper.engaged=false; });
      // clickable flipper UI (optional)
      const leftBtn = document.createElement('button'); leftBtn.textContent='Flipper ⬅ (Z)'; leftBtn.style.marginTop='8px'; leftBtn.className='glass'; leftBtn.onclick = ()=>{ leftFlipper.engaged=true; setTimeout(()=>leftFlipper.engaged=false,120); };
      const rightBtn = document.createElement('button'); rightBtn.textContent='(M) ➡ Flipper'; rightBtn.className='glass'; rightBtn.onclick = ()=>{ rightFlipper.engaged=true; setTimeout(()=>rightFlipper.engaged=false,120); };
      canvas.parentNode.appendChild(leftBtn); canvas.parentNode.appendChild(rightBtn);
    })();

    // === MODEL VIEWER HOOKS ===
    document.getElementById('loadModel').addEventListener('click', ()=>{
      const url = document.getElementById('modelUrl').value.trim(); if(!url) return alert('Paste a GLB URL'); document.getElementById('statueModel').setAttribute('src', url);
    });
    document.getElementById('spinModel').addEventListener('click', ()=>{ const mv = document.getElementById('statueModel'); mv.autoRotate = !mv.autoRotate; });

    // === TIKTOK EMBEDS ===
    document.getElementById('embedTt').addEventListener('click', ()=>{
      const id = document.getElementById('tiktokId').value.trim(); const wrap = document.getElementById('ttEmbedWrap'); wrap.innerHTML=''; if(!id) return alert('Enter a Video ID string');
      // Prefer iframe approach
      const iframe = document.createElement('iframe'); iframe.width=325; iframe.height=575; iframe.frameBorder=0; iframe.src = `https://www.tiktok.com/embed/v2/${encodeURIComponent(id)}`; iframe.allow='autoplay; encrypted-media'; wrap.appendChild(iframe);
      // fallback tip: if embed fails, user needs to host page so TikTok can load the embed script
    });

    // === MULTIPLAYER SIGNALING FILES (download) ===
    const serverJs = `// Minimal signaling server (Node.js)
const express = require('express');
const http = require('http');
const WebSocket = require('ws');
const app = express();
const server = http.createServer(app);
const wss = new WebSocket.Server({ server });
app.use(express.static('.'));
// Simple message broadcast in a room
wss.on('connection', ws => {
  ws.on('message', msg => {
    // msg should be JSON: {type:'join'|'signal', room:'room1', payload:...}
    try{ const data = JSON.parse(msg); if(data.room){ // broadcast to others in room
        wss.clients.forEach(client=>{ if(client!==ws && client.readyState===WebSocket.OPEN) client.send(msg); }); }
    }catch(e){ console.error('Invalid message', e); }
  });
});
const PORT = process.env.PORT || 3000; server.listen(PORT, ()=> console.log('Signaling server running on', PORT));`;
    const packageJson = `{
  "name": "signaling-server",
  "version": "1.0.0",
  "main": "server.js",
  "dependencies": {
    "express": "^4.18.2",
    "ws": "^8.13.0"
  }
}`;
    document.getElementById('dlServer').addEventListener('click', ()=>{ const b=new Blob([serverJs],{type:'text/javascript'}); const url=URL.createObjectURL(b); const a=document.createElement('a'); a.href=url; a.download='server.js'; a.click(); URL.revokeObjectURL(url); });
    document.getElementById('dlPackage').addEventListener('click', ()=>{ const b=new Blob([packageJson],{type:'application/json'}); const url=URL.createObjectURL(b); const a=document.createElement('a'); a.href=url; a.download='package.json'; a.click(); URL.revokeObjectURL(url); });
    document.getElementById('showClient').addEventListener('click', ()=>{ document.getElementById('clientSnippet').style.display='block'; });

    // === THEME TOGGLES ===
    document.getElementById('neonTheme').addEventListener('click', ()=>{
      document.documentElement.style.setProperty('--bg','#05030a'); document.documentElement.style.setProperty('--accent','#00ffea'); document.documentElement.style.setProperty('--accent2','#ff00ea'); document.body.style.background = 'radial-gradient(circle at 10% 20%, rgba(0,255,234,0.06), transparent), linear-gradient(180deg,#000004,#081018)';
    });
    document.getElementById('photorealTheme').addEventListener('click', ()=>{
      document.documentElement.style.setProperty('--bg','#0b0b0b'); document.documentElement.style.setProperty('--accent','#d4c19c'); document.documentElement.style.setProperty('--accent2','#b0a18a'); document.body.style.background = "linear-gradient(180deg,#0b0b0b,#141414)";
    });
    document.getElementById('pastelTheme').addEventListener('click', ()=>{
      document.documentElement.style.setProperty('--bg','#f6f7fb'); document.documentElement.style.setProperty('--accent','#ffb3c1'); document.documentElement.style.setProperty('--accent2','#b3d9ff'); document.body.style.background = 'linear-gradient(180deg,#fff,#f0f6ff)'; document.body.style.color='#111';
    });

    // small safe-check: prevent autoplay surprises
    document.querySelectorAll('video,audio').forEach(el=>el.addEventListener('play', ()=>console.log('media play')));
  </script>
</body>
</html>